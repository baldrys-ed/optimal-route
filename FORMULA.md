# –§–æ—Ä–º—É–ª–∞ –æ—Ü–µ–Ω–∫–∏ –ø–µ—à–µ—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `src/Service/RouteScoreService.php`.
–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–±—ä–µ–∫—Ç `result[0]` –∏–∑ –æ—Ç–≤–µ—Ç–∞ 2GIS Routing API v7.

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞

```
SCORE = path_quality √ó 0.55
      + crossing_safety √ó 0.30
      + turn_simplicity √ó 0.15
```

–†–µ–∑—É–ª—å—Ç–∞—Ç —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 10 –∏ –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ 1 –∑–Ω–∞–∫–∞.
–î–∏–∞–ø–∞–∑–æ–Ω: **0.0 ‚Äî 10.0**.

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 1 ‚Äî –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∫—Ä—ã—Ç–∏—è (`path_quality`, –≤–µ—Å 0.55)

–í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—Ä–µ–¥–Ω—è—è –ø–æ –¥–ª–∏–Ω–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞.
–ö–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç –±–µ—Ä—ë—Ç—Å—è –∏–∑ `maneuver.outcoming_path.geometry[]`.

### –§–æ—Ä–º—É–ª–∞

```
path_quality = Œ£(segment.length √ó style_weight) / Œ£(segment.length)
```

### –í–µ—Å–∞ —Å—Ç–∏–ª–µ–π

| `geometry.style`  | –û–ø–∏—Å–∞–Ω–∏–µ            | –í–µ—Å  |
|-------------------|---------------------|------|
| `park_path`       | –ü–∞—Ä–∫ / –±—É–ª—å–≤–∞—Ä      | 1.0  |
| `living_zone`     | –ñ–∏–ª–∞—è –∑–æ–Ω–∞          | 0.9  |
| `undergroundway`  | –ü–æ–¥–∑–µ–º–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥   | 0.85 |
| `archway`         | –ê—Ä–∫–∞ / –ø—Ä–æ—Ö–æ–¥       | 0.7  |
| `normal`          | –¢—Ä–æ—Ç—É–∞—Ä             | 0.5  |
| `crosswalk`       | –ü–µ—à–µ—Ö–æ–¥–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥  | 0.3  |
| `stairway`        | –õ–µ—Å—Ç–Ω–∏—Ü–∞            | 0.1  |
| –ø—Ä–æ—á–∏–µ            | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø     | 0.5  |

### –ü—Ä–∏–º–µ—Ä

–ú–∞—Ä—à—Ä—É—Ç 1000 –º: 800 –º —Ç—Ä–æ—Ç—É–∞—Ä + 150 –º –ø–∞—Ä–∫ + 50 –º –ª–µ—Å—Ç–Ω–∏—Ü–∞:

```
path_quality = (800√ó0.5 + 150√ó1.0 + 50√ó0.1) / 1000
             = (400 + 150 + 5) / 1000
             = 0.555
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 2 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (`crossing_safety`, –≤–µ—Å 0.30)

–°—Ä–µ–¥–Ω—è—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏.

### –ö–∞–∫–∏–µ –º–∞–Ω—ë–≤—Ä—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥–æ–º

2GIS –∫–æ–¥–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–æ—Ä–æ–≥–∏ –¥–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –º–∞–Ω—ë–≤—Ä–∞:

| `maneuver.type`             | –ö–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è                                          |
|-----------------------------|------------------------------------------------------------|
| `pedestrian_road_crossing`  | –Ø–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø—Ä–æ–µ–∑–∂—É—é —á–∞—Å—Ç—å (–≤–Ω–µ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–∫–∞)       |
| `pedestrian_crossroad`      | –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–∫–µ ‚Äî —á–∞—Å—Ç–æ —Ç–æ–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–µ–±—Ä—É/—Å–≤–µ—Ç–æ—Ñ–æ—Ä |

–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **–æ–±–∞ —Ç–∏–ø–∞**, –µ—Å–ª–∏ `maneuver.attribute` —Ä–∞–≤–µ–Ω `onto_crosswalk` –∏–ª–∏ `on_traffic_light`.

**–ò—Å–∫–ª—é—á–µ–Ω–∏–µ:** –º–∞–Ω—ë–≤—Ä—ã —Ç–∏–ø–∞ `pedestrian_crossroad`, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
—Å—Ç–∏–ª—å `undergroundway` ‚Äî —ç—Ç–æ –ø–æ–¥–∑–µ–º–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã, –æ–Ω–∏ —É–∂–µ —É—á—Ç–µ–Ω—ã –≤ `path_quality` —Å –≤–µ—Å–æ–º 0.85
–∏ –≤ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö —á–µ—Ä–µ–∑ –ø—Ä–æ–µ–∑–∂—É—é —á–∞—Å—Ç—å –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è.

### –§–æ—Ä–º—É–ª–∞

```
avg_safety       = Œ£(safety_score) / –∫–æ–ª-–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
quantity_penalty = exp(‚àí0.08 √ó –∫–æ–ª-–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)
crossing_safety  = avg_safety √ó quantity_penalty
```

–ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –Ω–µ—Ç ‚Äî `crossing_safety = 1.0` (–º–∞–∫—Å–∏–º—É–º).

`quantity_penalty` —à—Ç—Ä–∞—Ñ—É–µ—Ç –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: —á–µ–º –±–æ–ª—å—à–µ —Ç–æ—á–µ–∫ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
–ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏, —Ç–µ–º –≤—ã—à–µ —Å—É–º–º–∞—Ä–Ω—ã–π —Ä–∏—Å–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –∑–µ–±—Ä–µ.

### –û—Ü–µ–Ω–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ –∞—Ç—Ä–∏–±—É—Ç—É –º–∞–Ω—ë–≤—Ä–∞

| `maneuver.attribute`  | –û–ø–∏—Å–∞–Ω–∏–µ                | `avg_safety` |
|-----------------------|-------------------------|--------------|
| `on_traffic_light`    | –ü–µ—Ä–µ—Ö–æ–¥ —Å–æ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–æ–º   | 1.0          |
| `onto_crosswalk`      | –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∑–µ–±—Ä–µ        | 0.6          |
| `empty`               | –ü–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ —Ä–∞–∑–º–µ—Ç–∫–∏    | 0.2          |
| –ø—Ä–æ—á–∏–µ                | –ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω            | 0.2          |

### –®—Ç—Ä–∞—Ñ –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

| –ü–µ—Ä–µ—Ö–æ–¥–æ–≤ | `quantity_penalty` | –≤—Å–µ –∑–µ–±—Ä—ã ‚Üí `crossing_safety` |
|-----------|--------------------|-------------------------------|
| 0         | ‚Äî (–Ω–µ—Ç)            | **1.000**                     |
| 1         | 0.923              | 0.554                         |
| 2         | 0.852              | 0.511                         |
| 3         | 0.787              | 0.472                         |
| 6         | 0.619              | 0.371                         |
| 10        | 0.449              | 0.270                         |
| 14        | 0.325              | 0.195                         |

### –ü—Ä–∏–º–µ—Ä

6 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ –∑–µ–±—Ä–µ:

```
avg_safety       = (0.6 √ó 6) / 6     = 0.600
quantity_penalty = exp(‚àí0.08 √ó 6)    = 0.619
crossing_safety  = 0.600 √ó 0.619     = 0.371
```

3 –ø–µ—Ä–µ—Ö–æ–¥–∞: –∑–µ–±—Ä–∞ + –∑–µ–±—Ä–∞ + –±–µ–∑ —Ä–∞–∑–º–µ—Ç–∫–∏:

```
avg_safety       = (0.6 + 0.6 + 0.2) / 3 = 0.467
quantity_penalty = exp(‚àí0.08 √ó 3)         = 0.787
crossing_safety  = 0.467 √ó 0.787          = 0.367
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 3 ‚Äî –ü—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å (`turn_simplicity`, –≤–µ—Å 0.15)

–ù–∞—Å–∫–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç –ø—Ä—è–º–æ–ª–∏–Ω–µ–µ–Ω ‚Äî —à—Ç—Ä–∞—Ñ –∑–∞ –æ—Å—Ç—Ä—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã.
–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–∞–Ω—ë–≤—Ä—ã —Ç–∏–ø–∞ `pedestrian_crossroad` —Å –ø–æ–ª–µ–º `turn_angle`.
–ú–∞–Ω—ë–≤—Ä—ã `pedestrian_road_crossing` –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è (—É –Ω–∏—Ö `turn_angle_first/second`).

### –§–æ—Ä–º—É–ª–∞

```
avg_angle       = Œ£(|turn_angle|) / –∫–æ–ª-–≤–æ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤
turn_simplicity = 1 ‚àí (avg_angle / 180)
```

- 0¬∞ (–≤—Å—ë –ø—Ä—è–º–æ)  ‚Üí turn_simplicity = **1.0**
- 90¬∞ (—Ç–∏–ø–∏—á–Ω—ã–π –≥–æ—Ä–æ–¥) ‚Üí turn_simplicity = **0.5**
- 180¬∞ (—Ä–∞–∑–≤–æ—Ä–æ—Ç) ‚Üí turn_simplicity = **0.0**

–ï—Å–ª–∏ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ –Ω–µ—Ç ‚Äî `turn_simplicity = 1.0`.

### –ü—Ä–∏–º–µ—Ä

5 –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ —Å —É–≥–ª–∞–º–∏ 90¬∞, 90¬∞, 45¬∞, 0¬∞, 120¬∞:

```
avg_angle       = (90+90+45+0+120) / 5 = 69¬∞
turn_simplicity = 1 ‚àí (69 / 180) = 0.617
```

---

## –ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

–ú–∞—Ä—à—Ä—É—Ç 1.1 –∫–º, 12 –º–∏–Ω, 6 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ –∑–µ–±—Ä–µ:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç         | –ó–Ω–∞—á–µ–Ω–∏–µ | –í–µ—Å  | –í–∫–ª–∞–¥ |
|-------------------|----------|------|-------|
| `path_quality`    | 0.549    | 0.55 | 0.302 |
| `crossing_safety` | 0.600    | 0.30 | 0.180 |
| `turn_simplicity` | 0.839    | 0.15 | 0.126 |
| **SCORE**         |          |      | **√ó10 = 6.1** |

---

## –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ

–ú–∞—Ä—à—Ä—É—Ç —Ä–∏—Å—É–µ—Ç—Å—è —Ü–≤–µ—Ç–æ–º –ø–æ —Ç–∏–ø—É –ø–æ–∫—Ä—ã—Ç–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞:

| –¶–≤–µ—Ç     | –°—Ç–∏–ª—å             | –û–ø–∏—Å–∞–Ω–∏–µ            |
|----------|-------------------|---------------------|
| üîµ —Å–∏–Ω–∏–π  | `normal`          | –¢—Ä–æ—Ç—É–∞—Ä             |
| üü¢ –∑–µ–ª—ë–Ω—ã–π| `park_path`       | –ü–∞—Ä–∫ / –±—É–ª—å–≤–∞—Ä      |
| üü£ —Ñ–∏–æ–ª–µ—Ç.| `living_zone`     | –ñ–∏–ª–∞—è –∑–æ–Ω–∞          |
| üü† –æ—Ä–∞–Ω–∂. | `crosswalk`       | –ü–µ—à–µ—Ö–æ–¥–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥  |
| ‚ö´ —Å–µ—Ä—ã–π  | `undergroundway`  | –ü–æ–¥–∑–µ–º–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥   |
| üü§ –∫–æ—Ä–∏—á–Ω.| `archway`         | –ê—Ä–∫–∞ / –ø—Ä–æ—Ö–æ–¥       |
| üî¥ –∫—Ä–∞—Å–Ω—ã–π| `stairway`        | –õ–µ—Å—Ç–Ω–∏—Ü–∞            |

–ú–∞—Ä–∫–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ:

| –¶–≤–µ—Ç –º–∞—Ä–∫–µ—Ä–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ                                    |
|--------------|---------------------------------------------|
| üü¢ –∑–µ–ª—ë–Ω—ã–π   | –°—Ç–∞—Ä—Ç –º–∞—Ä—à—Ä—É—Ç–∞                              |
| üîµ —Å–∏–Ω–∏–π     | –§–∏–Ω–∏—à –º–∞—Ä—à—Ä—É—Ç–∞                              |
| üü† –æ—Ä–∞–Ω–∂–µ–≤—ã–π | –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–æ—Ä–æ–≥–∏ (–∑–µ–±—Ä–∞)                  |
| üü¢ —Ç—ë–º–Ω–æ-–∑–µ–ª.| –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–æ—Ä–æ–≥–∏ (—Å–≤–µ—Ç–æ—Ñ–æ—Ä)               |

---

## –®–∫–∞–ª–∞ –æ—Ü–µ–Ω–æ–∫

| –û—Ü–µ–Ω–∫–∞   | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è               |
|----------|-----------------------------|
| 8.0‚Äì10.0 | –û—Ç–ª–∏—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç            |
| 6.5‚Äì7.9  | –•–æ—Ä–æ—à–∏–π –º–∞—Ä—à—Ä—É—Ç             |
| 5.0‚Äì6.4  | –£–º–µ—Ä–µ–Ω–Ω–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π         |
| 0.0‚Äì4.9  | –ù–µ—É–¥–æ–±–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç           |

---

## –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

- `geometry[].style` ‚Äî —Ç–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è —É—á–∞—Å—Ç–∫–∞
- `geometry[].length` ‚Äî –¥–ª–∏–Ω–∞ —É—á–∞—Å—Ç–∫–∞ –≤ –º–µ—Ç—Ä–∞—Ö
- `maneuver.type` ‚Äî —Ç–∏–ø –º–∞–Ω—ë–≤—Ä–∞ (`pedestrian_road_crossing`, `pedestrian_crossroad`, ‚Ä¶)
- `maneuver.attribute` ‚Äî –∞—Ç—Ä–∏–±—É—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ (`onto_crosswalk`, `on_traffic_light`, `empty`)
- `maneuver.turn_angle` ‚Äî —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö (—Ç–æ–ª—å–∫–æ —É `pedestrian_crossroad`)
- `total_distance`, `total_duration` ‚Äî —Å—É–º–º–∞—Ä–Ω—ã–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –∏ –≤—Ä–µ–º—è
